<html>
    <head>
        <meta charset='utf-8' />
        <title> XAL </title>
        <link rel="icon" type="image/png" href="images/favicon_xal.png" />
        <link rel="stylesheet" type="text/css" href="css/style.css">
        <meta name="description" content="Xarxa Agroalimentaria Local (XAL)">
        <meta name="keywords" content="Xarxa, Agroalimentaria, Local, XAL">
        <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
        <script src='https://api.mapbox.com/mapbox-gl-js/v2.0.1/mapbox-gl.js'></script>
        <link href='https://api.mapbox.com/mapbox-gl-js/v2.0.1/mapbox-gl.css' rel='stylesheet' />
        <!--geocoder-->
        <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>
        <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css" type="text/css" />
        <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>
        <!--geocoder-->

        <script>

          function init() {
              mapboxgl.accessToken =
                  'pk.eyJ1IjoiZW1vbHRvdmk3IiwiYSI6ImNrNWNwMTB4NTA5djYzbnFmczVtZWN5bGQifQ.4TZHCIF2dT6LtuzwqD-KrA';
              var map = new mapboxgl.Map({
                  container: 'map_canvas',
                  style: 'mapbox://styles/emoltovi7/ckkvftb5w42c817nzf9w21pqa',
                  center: [2.058356166296968, 41.39816698110466],
                  zoom: 10.5,
                  attributionControl: false
              });
              /*geocoder*/
              map.addControl(new MapboxGeocoder({accessToken: mapboxgl.accessToken, mapboxgl:mapboxgl}));
              map.addControl(new mapboxgl.NavigationControl({showCompass:false}), 'top-right');


              //afegir capes
              map.on('load', function () {

                        //afegir capa explotacions agràries
                        map.addSource('exp_agr_source', {
                            type: 'vector',
                            url: 'mapbox://emoltovi7.5mnkrjm4'
                        });

                        map.addLayer({
                            'id': 'Explotacions agràries',
                            'type': 'fill',
                            'source': 'exp_agr_source',
                            'layout': {'visibility': 'visible'},
                            'paint':{
                                'fill-opacity': 0.5,
                                'fill-color':'#36A1A1'
                            },
                            'source-layer': 'exp_agr-1dkq0e'
                        });
                
                        //afegir capa cultius
                        map.addSource('cultius_source', {
                            type: 'vector',
                            url: 'mapbox://emoltovi7.ckl6o1elc07ha29mbf3teedta-1u9lm'
                        });

                        map.addLayer({
                            'id': 'Cultius',
                            'type': 'fill',
                            'source': 'cultius_source',
                            'layout': {'visibility': 'visible'},
                            'paint':{
                                'fill-opacity': 0.5,
                                'fill-color':'#A3D94C'
                            },
                            'source-layer': 'cultius'
                        });
                
                        //afegir capa L17
                        map.addSource('lc17_source', {
                            type: 'vector',
                            url: 'mapbox://emoltovi7.ckl71gaaz0l0l27l3y9lgw0pn-1l6s5'
                        });

                        map.addLayer({
                            'id': 'Vinya',
                            'type': 'circle',
                            'source': 'lc17_source',
                            'layout': {'visibility': 'visible'},
                            'paint':{
                                'circle-radius': 4,
                                'circle-color':'#94346E'
                            },
                            'source-layer': 'lc17'
                        });

                        //afegir capa L16
                        map.addSource('lc16_source', {
                            type: 'vector',
                            url: 'mapbox://emoltovi7.ckl71fuhr1zr022qpq60hjsbq-7y7o8'
                        });

                        map.addLayer({
                            'id': 'Hortalisses',
                            'type': 'circle',
                            'source': 'lc16_source',
                            'layout': {'visibility': 'visible'},
                            'paint':{
                                'circle-radius': 4,
                                'circle-color':'#73AF48'
                            },
                            'source-layer': 'lc16'
                        });

                        //afegir capa L15
                        map.addSource('lc15_source', {
                            type: 'vector',
                            url: 'mapbox://emoltovi7.ckl71fj7r0m4a20ol17gcqdrc-2qgcd'
                        });

                        map.addLayer({
                            'id': 'Peix i marisc',
                            'type': 'circle',
                            'source': 'lc15_source',
                            'layout': {'visibility': 'visible'},
                            'paint':{
                                'circle-radius': 4,
                                'circle-color':'#FB8072'
                            },
                            'source-layer': 'lc15'
                        });

                        //afegir capa L14
                        map.addSource('lc14_source', {
                            type: 'vector',
                            url: 'mapbox://emoltovi7.ckl71f88f0a1y27pfyszq0gyr-409v5'
                        });

                        map.addLayer({
                            'id': 'Cereals',
                            'type': 'circle',
                            'source': 'lc14_source',
                            'layout': {'visibility': 'visible'},
                            'paint':{
                                'circle-radius': 4,
                                'circle-color':'#FFED6F'
                            },
                            'source-layer': 'lc14'
                        });

                        //afegir capa L13
                        map.addSource('lc13_source', {
                            type: 'vector',
                            url: 'mapbox://emoltovi7.ckl71evb60vw222o4zrh8sdc2-0eayd'
                        });

                        map.addLayer({
                            'id': 'Pa i pastissos',
                            'type': 'circle',
                            'source': 'lc13_source',
                            'layout': {'visibility': 'visible'},
                            'paint':{
                                'circle-radius': 4,
                                'circle-color':'#5F4690'
                            },
                            'source-layer': 'lc13'
                        });

                        //afegir capa L12
                        map.addSource('lc12_source', {
                            type: 'vector',
                            url: 'mapbox://emoltovi7.ckl71eed11d6z27mxgwj6mgd8-42yar'
                        });

                        map.addLayer({
                            'id': 'Oli i olives',
                            'type': 'circle',
                            'source': 'lc12_source',
                            'layout': {'visibility': 'visible'},
                            'paint':{
                                'circle-radius': 4,
                                'circle-color':'#0F8554'
                            },
                            'source-layer': 'lc12'
                        });

                        //afegir capa L1
                        map.addSource('lc1_source', {
                            type: 'vector',
                            url: 'mapbox://emoltovi7.ckl7189s80kud20pgf495r27g-5n5n8'
                        });

                        map.addLayer({
                            'id': 'Mercat municipal',
                            'type': 'circle',
                            'source': 'lc1_source',
                            'layout': {'visibility': 'visible'},
                            'paint':{
                                'circle-radius': 4,
                                'circle-color':'#FA0022'
                            },
                            'source-layer': 'lc1'
                        });

                        //afegir capa L11
                        map.addSource('lc11_source', {
                            type: 'vector',
                            url: 'mapbox://emoltovi7.ckl71e1my1rit21nhco9ohtt6-8fg6j'
                        });

                        map.addLayer({
                            'id': 'Llegums',
                            'type': 'circle',
                            'source': 'lc11_source',
                            'layout': {'visibility': 'visible'},
                            'paint':{
                                'circle-radius': 4,
                                'circle-color':'#6F4070'
                            },
                            'source-layer': 'lc11'
                        });

                        //afegir capa L10
                        map.addSource('lc10_source', {
                            type: 'vector',
                            url: 'mapbox://emoltovi7.ckl71dq6201ah27o16bo9x4j0-8ymzv'
                        });

                        map.addLayer({
                            'id': 'Herbes aromàtiques i condiments',
                            'type': 'circle',
                            'source': 'lc10_source',
                            'layout': {'visibility': 'visible'},
                            'paint':{
                                'circle-radius': 4,
                                'circle-color':'#EDAD08'
                            },
                            'source-layer': 'lc10'
                        });

                        //afegir capa L9
                        map.addSource('lc9_source', {
                            type: 'vector',
                            url: 'mapbox://emoltovi7.ckl71de6l02b428qmvbopsvz7-8q2zj'
                        });

                        map.addLayer({
                            'id': 'Fruits secs',
                            'type': 'circle',
                            'source': 'lc9_source',
                            'layout': {'visibility': 'visible'},
                            'paint':{
                                'circle-radius': 4,
                                'circle-color':'#8BE0A4'
                            },
                            'source-layer': 'lc9'
                        });

                        //afegir capa L8
                        map.addSource('lc8_source', {
                            type: 'vector',
                            url: 'mapbox://emoltovi7.ckl71d1960ac428mbbz70xf37-3l909'
                        });

                        map.addLayer({
                            'id': 'Fruita',
                            'type': 'circle',
                            'source': 'lc8_source',
                            'layout': {'visibility': 'visible'},
                            'paint':{
                                'circle-radius': 4,
                                'circle-color':'#FF4F33'
                            },
                            'source-layer': 'lc8'
                        });

                        //afegir capa L7
                        map.addSource('lc7_source', {
                            type: 'vector',
                            url: 'mapbox://emoltovi7.ckl71cnxy0m3320ol9bev0gmu-9yjwp'
                        });

                        map.addLayer({
                            'id': 'Formatge i làctics',
                            'type': 'circle',
                            'source': 'lc7_source',
                            'layout': {'visibility': 'visible'},
                            'paint':{
                                'circle-radius': 4,
                                'circle-color':'#1D6996'
                            },
                            'source-layer': 'lc7'
                        });

                        //afegir capa L3
                        map.addSource('lc3_source', {
                            type: 'vector',
                            url: 'mapbox://emoltovi7.ckl71altd0kyh27o2zxntygmp-1z7py'
                        });

                        map.addLayer({
                            'id': 'Fires',
                            'type': 'circle',
                            'source': 'lc3_source',
                            'layout': {'visibility': 'visible'},
                            'paint':{
                                'circle-radius': 4,
                                'circle-color':'#E73F74'
                            },
                            'source-layer': 'lc3'
                        });

                        //afegir capa L6
                        map.addSource('lc6_source', {
                            type: 'vector',
                            url: 'mapbox://emoltovi7.ckl71cc2a0kyy27o2lkjnfrt7-27dag'
                        });

                        map.addLayer({
                            'id': 'Carn i embotits',
                            'type': 'circle',
                            'source': 'lc6_source',
                            'layout': {'visibility': 'visible'},
                            'paint':{
                                'circle-radius': 4,
                                'circle-color':'#FE88B1'
                            },
                            'source-layer': 'lc6'
                        });

                        //afegir capa L2
                        map.addSource('lc2_source', {
                            type: 'vector',
                            url: 'mapbox://emoltovi7.ckl71926u0amc20mbmhzgizfg-799ik'
                        });

                        map.addLayer({
                            'id': 'Comerç al detall',
                            'type': 'circle',
                            'source': 'lc2_source',
                            'layout': {'visibility': 'visible'},
                            'paint':{
                                'circle-radius': 4,
                                'circle-color':'#A5AA99'
                            },
                            'source-layer': 'lc2'
                        });

                        //afegir capa L18
                        map.addSource('lc18_source', {
                            type: 'vector',
                            url: 'mapbox://emoltovi7.ckl71gkwn0aaf27mdye0izu2z-2f1q1'
                        });

                        map.addLayer({
                            'id': 'Café, te, xocolata i sucre',
                            'type': 'circle',
                            'source': 'lc18_source',
                            'layout': {'visibility': 'visible'},
                            'paint':{
                                'circle-radius': 4,
                                'circle-color':'#933622'
                            },
                            'source-layer': 'lc18'
                        });

                        //afegir capa L5
                        map.addSource('lc5_source', {
                            type: 'vector',
                            url: 'mapbox://emoltovi7.ckl71bu3p0zue21phv1xwl9g4-1do83'
                        });

                        map.addLayer({
                            'id': 'Begudes (vi, cava, licors, cerveses)',
                            'type': 'circle',
                            'source': 'lc5_source',
                            'layout': {'visibility': 'visible'},
                            'paint':{
                                'circle-radius': 4,
                                'circle-color':'#5D69B1'
                            },
                            'source-layer': 'lc5'
                        });

                        //afegir capa L4
                        map.addSource('lc4_source', {
                            type: 'vector',
                            url: 'mapbox://emoltovi7.ckl71bgpt0amr20mbi7n8bd62-8hogh'
                        });

                        map.addLayer({
                            'id': 'Aviram i ous',
                            'type': 'circle',
                            'source': 'lc4_source',
                            'layout': {'visibility': 'visible'},
                            'paint':{
                                'circle-radius': 4,
                                'circle-color':'#38A6A5'
                            },
                            'source-layer': 'lc4'
                        });


                });
                //final afegir capes

                //afegir popup
                map.on('click', function(e) {
                                  var features = map.queryRenderedFeatures(e.point, {
                                      layers: ['Vinya', 'Hortalisses', 'Peix i marisc', 'Cereals', 'Pa i pastissos', 'Oli i olives', 'Mercat municipal', 'Llegums', 'Herbes aromàtiques i condiments', 
                                      'Fruits secs', 'Fruita', 'Formatge i làctics', 'Fires', 'Carn i embotits', 'Comerç al detall', 'Café, te, xocolata i sucre', 'Begudes (vi, cava, licors, cerveses)', 'Aviram i ous']
                                  });

                                  if (!features.length) {
                                      return;
                                  }

                                  var feature = features[0];

                                  var popup = new mapboxgl.Popup({ offset: [0, -15] })
                                      .setLngLat(feature.geometry.coordinates)
                                      .setHTML('<h3>' + feature.properties.Nom + '</h3><p>Adreça: ' + feature.properties.Adreça + ', ' + feature.properties.Municipi + ', 0' + feature.properties.CodiPostal + '</p><p>Correu electrònic: ' + feature.properties.Correu + '</p><p>Web: ' + feature.properties.Web + '</p><p>Telèfon: ' + feature.properties.Telèfon + '</p>')
                                      .setLngLat(feature.geometry.coordinates)
                                      .addTo(map);
                            });

                          map.on('mouseenter', 'Vinya', function() {
                          map.getCanvas().style.cursor = 'pointer';                    
                          });

                          map.on('mouseleave', 'Vinya', function() {
                            map.getCanvas().style.cursor = '';                    
                          });

                          map.on('mouseenter', 'Hortalisses', function() {
                          map.getCanvas().style.cursor = 'pointer';                    
                          });

                          map.on('mouseleave', 'Hortalisses', function() {
                            map.getCanvas().style.cursor = '';                    
                          });

                          map.on('mouseenter', 'Peix i marisc', function() {
                          map.getCanvas().style.cursor = 'pointer';                    
                          });

                          map.on('mouseleave', 'Peix i marisc', function() {
                            map.getCanvas().style.cursor = '';                    
                          });

                          map.on('mouseenter', 'Cereals', function() {
                          map.getCanvas().style.cursor = 'pointer';                    
                          });

                          map.on('mouseleave', 'Cereals', function() {
                            map.getCanvas().style.cursor = '';                    
                          });

                          map.on('mouseenter', 'Pa i pastissos', function() {
                          map.getCanvas().style.cursor = 'pointer';                    
                          });

                          map.on('mouseleave', 'Pa i pastissos', function() {
                            map.getCanvas().style.cursor = '';                    
                          });

                          map.on('mouseenter', 'Oli i olives', function() {
                          map.getCanvas().style.cursor = 'pointer';                    
                          });

                          map.on('mouseleave', 'Oli i olives', function() {
                            map.getCanvas().style.cursor = '';                    
                          });

                          map.on('mouseenter', 'Mercat municipal', function() {
                          map.getCanvas().style.cursor = 'pointer';                    
                          });

                          map.on('mouseleave', 'Mercat municipal', function() {
                            map.getCanvas().style.cursor = '';                    
                          });

                          map.on('mouseenter', 'Llegums', function() {
                          map.getCanvas().style.cursor = 'pointer';                    
                          });

                          map.on('mouseleave', 'Llegums', function() {
                            map.getCanvas().style.cursor = '';                    
                          });

                          map.on('mouseenter', 'Herbes aromàtiques i condiments', function() {
                          map.getCanvas().style.cursor = 'pointer';                    
                          });

                          map.on('mouseleave', 'Herbes aromàtiques i condiments', function() {
                            map.getCanvas().style.cursor = '';                    
                          });

                          map.on('mouseenter', 'Fruits secs', function() {
                          map.getCanvas().style.cursor = 'pointer';                    
                          });

                          map.on('mouseleave', 'Fruits secs', function() {
                            map.getCanvas().style.cursor = '';                    
                          });

                          map.on('mouseenter', 'Fruita', function() {
                          map.getCanvas().style.cursor = 'pointer';                    
                          });

                          map.on('mouseleave', 'Fruita', function() {
                            map.getCanvas().style.cursor = '';                    
                          });

                          map.on('mouseenter', 'Formatge i làctics', function() {
                          map.getCanvas().style.cursor = 'pointer';                    
                          });

                          map.on('mouseleave', 'Formatge i làctics', function() {
                            map.getCanvas().style.cursor = '';                    
                          });

                          map.on('mouseenter', 'Fires', function() {
                          map.getCanvas().style.cursor = 'pointer';                    
                          });

                          map.on('mouseleave', 'Fires', function() {
                            map.getCanvas().style.cursor = '';                    
                          });

                          map.on('mouseenter', 'Carn i embotits', function() {
                          map.getCanvas().style.cursor = 'pointer';                    
                          });

                          map.on('mouseleave', 'Carn i embotits', function() {
                            map.getCanvas().style.cursor = '';                    
                          });

                          map.on('mouseenter', 'Comerç al detall', function() {
                          map.getCanvas().style.cursor = 'pointer';                    
                          });

                          map.on('mouseleave', 'Comerç al detall', function() {
                            map.getCanvas().style.cursor = '';                    
                          });

                          map.on('mouseenter', 'Café, te, xocolata i sucre', function() {
                          map.getCanvas().style.cursor = 'pointer';                    
                          });

                          map.on('mouseleave', 'Café, te, xocolata i sucre', function() {
                            map.getCanvas().style.cursor = '';                    
                          });

                          map.on('mouseenter', 'Begudes (vi, cava, licors, cerveses)', function() {
                          map.getCanvas().style.cursor = 'pointer';                    
                          });

                          map.on('mouseleave', 'Begudes (vi, cava, licors, cerveses)', function() {
                            map.getCanvas().style.cursor = '';                    
                          });

                          map.on('mouseenter', 'Aviram i ous', function() {
                          map.getCanvas().style.cursor = 'pointer';                    
                          });

                          map.on('mouseleave', 'Aviram i ous', function() {
                            map.getCanvas().style.cursor = '';                    
                          });
                          //final afegir popup

                //afegir selector de capes
                var toggleableLayerIds = ['Aviram i ous', 'Begudes (vi, cava, licors, cerveses)', 'Café, te, xocolata i sucre', 'Carn i embotits', 'Cereals', 'Comerç al detall', 'Fires', 'Formatge i làctics', 
                                          'Fruita', 'Fruits secs', 'Herbes aromàtiques i condiments', 'Hortalisses', 'Llegums', 'Mercat municipal', 'Oli i olives', 'Pa i pastissos', 'Peix i marisc', 'Vinya', 'Cultius', 'Explotacions agràries']; 
                                          
                
                // **set up the corresponding toggle button for each layer
                for (var i = 0; i < toggleableLayerIds.length; i++) {
                var id = toggleableLayerIds[i];
                  
                var link = document.createElement('a');
                link.href = '#';
                link.className = 'active';
                link.textContent = id;
                  
                link.onclick = function (e) {
                var clickedLayer = this.textContent;
                e.preventDefault();
                e.stopPropagation();
                  
                var visibility = map.getLayoutProperty(clickedLayer, 'visibility');
                  
                // **toggle layer visibility by changing the layout object's visibility property
                if (visibility === 'visible') {
                map.setLayoutProperty(clickedLayer, 'visibility', 'none');
                this.className = '';
                } else {
                this.className = 'active';
                map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
                }
                };
                  
                var layers = document.getElementById('menu');
                layers.appendChild(link);
                }
                //final selector de capes


          }
        </script>

    </head>
    <body onload="init()">
      <!--CAPÇALERA-->
        <header>

          <!--logo xal esquerra-->
          <div id=header_left>
            <a href="index.html"><img id="logo_XAL" src="images/logo_xal.svg"></a>
          </div>

          <!--menu superior-->
          <div id=header_menu>
            <nav>
							<ul id="menu_nav">
                <li>
									<a id="active_web" href="locals.html" title="holi">Productes locals</a>
								</li>
								<li>
									<a href="ecos.html">Productes ecològics</a>
								</li>
								<li>
									<a href="tots.html">Tots els productes</a>
								</li>
							</ul>
					</nav>
          </div>

          <!--logo amb dreta--> 
          <div id=header_right>
            <img id="logo_AMB" src="images/logo_AMB.png" >
          </div>
          
        </header>
      
        <!--MAPA-->
        <main>
          <nav id="menu"></nav>
          <div id="map_canvas"></div>
          <div id="map_legend" class="legend">
            <div><span style="background-color: #38A6A5"></span>Aviram i ous</div>
            <div><span style="background-color: #5D69B1"></span>Begudes (vi, cava, licors, cerveses)</div>
            <div><span style="background-color: #933622"></span>Café, te, xocolata i sucre</div>
            <div><span style="background-color: #FE88B1"></span>Carn i embotits</div>
            <div><span style="background-color: #FFED6F"></span>Cereals</div>
            <div><span style="background-color: #A5AA99"></span>Comerç al detall</div>
            <div><span style="background-color: #E73F74"></span>Fires</div>
            <div><span style="background-color: #1D6996"></span>Formatges i làctics</div>
            <div><span style="background-color: #FF4F33"></span>Fruita</div>
            <div><span style="background-color: #8BE0A4"></span>Fruits secs</div>
            <div><span style="background-color: #EDAD08"></span>Herbes aromàtiques i condiments</div>
            <div><span style="background-color: #73AF48"></span>Hortalisses</div>
            <div><span style="background-color: #6F4070"></span>Llegums</div>
            <div><span style="background-color: #FF0022"></span>Mercat municipal</div>
            <div><span style="background-color: #0F8554"></span>Oli i olives</div>
            <div><span style="background-color: #5F4690"></span>Pa i pastissos</div>
            <div><span style="background-color: #FB8072"></span>Peix i marisc</div>
            <div><span style="background-color: #94346E"></span>Vinya</div>
            <div><span style="background-color: #A3D94C"></span>Cultius</div>
            <div><span style="background-color: #36A1A1"></span>Explotacions agràries</div>
          </div>
        </main>

      <!--PEU-->
        <footer>
          <!--selector idioma-->
          <div id="idiomas">  

            <ul id="lista_idiomas">

              <li><a href="#">Català</a></li>
              <li><a href="#">Castellano</a></li>
              <li><a href="#">English</a></li>

            </ul>

          </div>

          <div id="links_externos">
            <ul id="links_externos">

              <li>
                <a href="#">Política de privacitat</a>
              </li>
              <li>
                <a href="#">Avís legal</a>
              </li>
              <li>
                <a href="#">L'àrea metropolitana</a>

              </li>

            </ul>
          </div>
        </footer>

    </body>
</html>